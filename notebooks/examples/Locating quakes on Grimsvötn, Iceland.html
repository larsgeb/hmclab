<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Probabilistic Elastic FWI" href="Elastic%202d%20FWI.html" /><link rel="prev" title="Linear (sparse) forward operator" href="Sampling%20sparse%20linear%20equations.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>Locating quakes on Grimsvötn, Iceland - Version 1.0</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../_static/autoclasstoc.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Version 1.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/HMC Lab.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/HMC Lab-dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Version 1.0</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">HMC Lab // Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hmc.html">The Hamiltonian Monte Carlo algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Installation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../notebooks.html">Notebooks: Examples and tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../../index-tutorials.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/0%20-%20Getting%20started.html">Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/1%20-%20Tuning%20Hamiltonian%20Monte%20Carlo.html">Tuning Hamiltonian Monte Carlo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/2%20-%20Separate%20priors%20per%20dimension.html">Separate priors per dimension</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/3%20-%20Creating%20your%20own%20inverse%20problem.html">Creating your own inverse problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/4%20-%20Running%20parallel%20Markov%20chains.html">Running parallel Markov chains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/5%20-%20Transforming%20parameters.html">Transforming existing distributions</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../../index-examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Sampling%20linear%20equations.html">Linear (dense) forward operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="Sampling%20sparse%20linear%20equations.html">Linear (sparse) forward operator</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Locating quakes on Grimsvötn, Iceland</a></li>
<li class="toctree-l3"><a class="reference internal" href="Elastic%202d%20FWI.html">Probabilistic Elastic FWI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/distributions/index.html">Distributions</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions._AbstractDistribution.html">_AbstractDistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.StandardNormal1D.html">StandardNormal1D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Normal.html">Normal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Laplace.html">Laplace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Uniform.html">Uniform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.LinearMatrix.html">LinearMatrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.CompositeDistribution.html">CompositeDistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.AdditiveDistribution.html">AdditiveDistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.BayesRule.html">BayesRule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Himmelblau.html">Himmelblau</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.SourceLocation2D.html">SourceLocation2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.SourceLocation3D.html">SourceLocation3D</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/massmatrices/index.html">MassMatrices</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/massmatrices/_autosummary/hmclab.MassMatrices._AbstractMassMatrix.html">_AbstractMassMatrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/massmatrices/_autosummary/hmclab.MassMatrices.Unit.html">Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/massmatrices/_autosummary/hmclab.MassMatrices.Diagonal.html">Diagonal</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/samplers/index.html">Samplers</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/samplers/_autosummary/hmclab.Samplers._AbstractSampler.html">_AbstractSampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/samplers/_autosummary/hmclab.Samplers.RWMH.html">RWMH</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/samplers/_autosummary/hmclab.Samplers.HMC.html">HMC</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/optimizers/index.html">Optimizers</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/optimizers/_autosummary/hmclab.Optimizers.gradient_descent.html">hmclab.Optimizers.gradient_descent</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/visualization/index.html">Visualization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualization/marginal.html">marginal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualization/marginal_grid.html">marginal_grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualization/visualize_2_dimensions.html">visualize_2_dimensions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/_autosummary/hmclab.Samples.html">Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../py-modindex.html">Module index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Alphabetic index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Locating-quakes-on-Grimsvötn,-Iceland">
<h1>Locating quakes on Grimsvötn, Iceland<a class="headerlink" href="#Locating-quakes-on-Grimsvötn,-Iceland" title="Permalink to this headline">#</a></h1>
<p><em>Accompanying notebook for HMCLab</em></p>
<p><em>Copyright 2022, Lars Gebraad, Andrea Zunino, Andreas Fichtner, Sara Klaasen</em></p>
<p><img alt="title" src="../../_images/aerial-snowcat-truck-people-grimsvotn.jpg"/> <em>A superjeep and a snowcat used by researchers atop Grímsvötn are seen in this drone-captured photo, with the volcanic caldera in the background. Credit: Hildur Jónsdóttir</em></p>
<p>This notebook demos the HMCLab software in a real data application. It highlights different approaches to make Probabilistic interpretations of data accessible and possible. The important concepts for this notebook are Hamiltonian Monte Carlo, Parallel tempering and simply model of physics.</p>
<p>We study data obtained at the Grimsvötn volcano in Iceland. Here, seismic data was captured using a distributed acoustic sensing (DAS) fiber. We will try to place events recorded with that cable using a homogeneous subsurface model, and probabilistic interpretation of the data. We show how this is possible with HMCLab, and why it is essential to use HMC + mutliple markov chains to solve this inverse problem. Lastly, we’ll have some fun with the results, to also show how the probabilistic
interpretation has practical uses.</p>
<p>For more information on the fieldwork, we refer to Sara Klaasen <a class="reference external" href="mailto:sara.klaasen%40erdw.ethz.ch">(sara<span>.</span>klaasen<span>@</span>erdw<span>.</span>ethz<span>.</span>ch)</a>, or to read the articles <a class="reference external" href="https://eos.org/science-updates/sensing-icelands-most-active-volcano-with-a-buried-hair">here at EOS</a> or <a class="reference external" href="https://ethambassadors.ethz.ch/2021/10/28/measuring-the-fiery-pulse-beneath-europes-largest-glacier/">here at ETH Ambassadors</a>.</p>
<p>Let’s first get our imports out of the way:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These two imports belong to HMCLab</span>
<span class="kn">import</span> <span class="nn">hmclab</span>
<span class="kn">from</span> <span class="nn">locatingquakes.helpers</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># With this one just providing nice tools for only this notebook</span>

<span class="c1"># And all the following should be installed with HMCLab</span>
<span class="kn">import</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span><span class="o">,</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">tilemapbase</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>


<span class="c1"># Alter to make the plots size appropriate for your screen</span>
<span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">figsize_double</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">figsize_triple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/larsgebraad/.conda/envs/hmclab-dev/lib/python3.8/site-packages/pkg_resources/__init__.py:122: PkgResourcesDeprecationWarning: 1.0-beta03-13-g2789f3a-dirty is an invalid version and will not be supported in a future release
  warnings.warn(
</pre></div></div>
</div>
<section id="Intro">
<h2>Intro<a class="headerlink" href="#Intro" title="Permalink to this headline">#</a></h2>
<p>This notebook let’s us invert for multiple earthquake source locations in a 3D space, given some known or unknown homogeneous medium velocity and unknown origin time.</p>
<p>We will go through the following sections in this notebook:</p>
<ol class="arabic simple">
<li><p>Straight ray homogeneous medium traveltime <strong>physics</strong>, i.e. simply distance / time = velocity;</p></li>
<li><p><strong>Geometry and domain:</strong> An array of receivers that observers the first arrival of the event, e.g. a picked arrival time on a seismogram. In this notebook, we will use a DAS array deployed on the Grimsvötn caldera;</p></li>
<li><p>Probabilistic interpretation of the <strong>data</strong>;</p></li>
<li><p>Modelling our <strong>prior</strong> expectations, creating a <strong>posterior</strong>;</p></li>
<li><p><strong>Sampling</strong> using parallel Hamiltonian Monte Carlo;</p></li>
<li><p><strong>Analsysis and interpretation</strong> of the samples.</p></li>
</ol>
</section>
<section id="1:-The-physics">
<h2>1: The physics<a class="headerlink" href="#1:-The-physics" title="Permalink to this headline">#</a></h2>
<p>The physics of first arrivals is modeled simply by calculating the distance between source and receivers, and calculating the travel time between those points for a given medium velocity. This is implemented in <code class="docutils literal notranslate"><span class="pre">hmclab.Distributions.SourceLocation3D</span></code>. It also includes the gradients for a given set of locations, i.e. in what direction one would have to perturb their sources to increase data fit. So, in this seciton, there is nothing to do!</p>
</section>
<section id="2:-The-domain">
<h2>2: The domain<a class="headerlink" href="#2:-The-domain" title="Permalink to this headline">#</a></h2>
<p>In this section, we will load the domain and DAS receiver geometry. These are supplied in polar coordinates, so we will use ObsPy in the background to convert these to a local coordinate system in kilometres.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"locatingquakes/data/xyz_polar.csv"</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
<span class="n">channel</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"channels"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lon_das_polar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"longitude"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lat_das_polar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"latitude"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">z_das_polar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"elevation"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Define the middle of the array as our new local origin.</span>
<span class="n">origin</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lat_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>Now we convert the geometry given in polar coordinates to a local cartesian interpreation using the new origin, and work in metres rather than kilometres.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_das</span><span class="p">,</span> <span class="n">y_das</span> <span class="o">=</span> <span class="n">to_xyz</span><span class="p">(</span>
    <span class="n">lon_das_polar</span><span class="p">,</span> <span class="n">lat_das_polar</span><span class="p">,</span> <span class="p">(</span><span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lat_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="p">)</span>

<span class="c1"># to metres</span>
<span class="n">x_das</span> <span class="o">*=</span> <span class="mf">1e3</span>
<span class="n">y_das</span> <span class="o">*=</span> <span class="mf">1e3</span>
<span class="n">z_das</span> <span class="o">=</span> <span class="n">z_das_polar</span>
</pre></div>
</div>
</div>
<p>Let’s compare these two representations of our geometry, just to get a feeling of the domain we work in.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize_double</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"DAS acquisition geometry [X,Y,Z]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_das</span><span class="p">,</span> <span class="n">y_das</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"x [m]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"y [m]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"DAS acquisition geometry [spherical coordinates]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon_das_polar</span><span class="p">,</span> <span class="n">lat_das_polar</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"latitude"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_13_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_13_0.png"/>
</div>
</div>
<p>This, of course, looks better on an actual map. It is a bit tedious to plot the XYZ system we use on a map, requiring 2 transformations (XYZ-&gt;latlon-&gt;map unit square).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the background image source</span>
<span class="n">tilemapbase</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">map_background</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">Stamen_Terrain_Background</span>

<span class="c1"># Set the map extent of the maps</span>
<span class="n">degrees_range1</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">extent1</span> <span class="o">=</span> <span class="n">tilemapbase_create_extent</span><span class="p">(</span>
    <span class="p">(</span><span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">lat_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">degrees_range1</span>
<span class="p">)</span>
<span class="n">degrees_range2</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="n">extent2</span> <span class="o">=</span> <span class="n">tilemapbase_create_extent</span><span class="p">(</span>
    <span class="p">(</span><span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lat_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">degrees_range2</span>
<span class="p">)</span>

<span class="c1"># Create figure and axes</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize_double</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Create the backgrounds in the axes</span>
<span class="n">plotter1</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">extent1</span><span class="p">,</span> <span class="n">map_background</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plotter1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">map_background</span><span class="p">)</span>
<span class="n">plotter2</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">extent2</span><span class="p">,</span> <span class="n">map_background</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plotter2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">map_background</span><span class="p">)</span>

<span class="c1"># Plot the inset</span>
<span class="n">rectangle</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
    <span class="p">(</span><span class="n">extent2</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">extent2</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span>
    <span class="n">extent2</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">extent2</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"r"</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">"detail"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rectangle</span><span class="p">)</span>

<span class="c1"># Project the DAS geometry to map coordinates</span>
<span class="n">xproj_das</span><span class="p">,</span> <span class="n">yproj_das</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
    <span class="n">lon_das_polar</span><span class="p">,</span> <span class="n">lat_das_polar</span><span class="p">,</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span>
<span class="p">)</span>

<span class="c1"># Plot the cable</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xproj_das</span><span class="p">,</span> <span class="n">yproj_das</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"DAS acquisition geometry"</span><span class="p">)</span>

<span class="c1"># Plot a grid (messy!)</span>
<span class="n">lo</span><span class="p">,</span> <span class="n">ro</span> <span class="o">=</span> <span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span>
<span class="n">xproj_grid</span><span class="p">,</span> <span class="n">yproj_grid</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">lo</span><span class="p">,</span> <span class="n">ro</span><span class="p">,</span> <span class="n">ro</span><span class="p">,</span> <span class="n">lo</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">[</span><span class="mf">63.0</span><span class="p">,</span> <span class="mf">63.0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">68</span><span class="p">],</span>
    <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xproj_grid</span><span class="p">,</span> <span class="n">yproj_grid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xproj_grid</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0072</span><span class="p">,</span> <span class="n">yproj_grid</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mf">3e-4</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="mi">63</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="si">}</span><span class="s1">"N'</span><span class="p">)</span>
<span class="n">lo</span><span class="p">,</span> <span class="n">ro</span> <span class="o">=</span> <span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.75</span>
<span class="n">lat</span> <span class="o">=</span> <span class="p">[</span><span class="mf">64.0</span><span class="p">,</span> <span class="mf">64.0</span><span class="p">,</span> <span class="mf">64.2</span><span class="p">,</span> <span class="mf">64.2</span><span class="p">,</span> <span class="mf">64.4</span><span class="p">,</span> <span class="mf">64.4</span><span class="p">,</span> <span class="mf">64.6</span><span class="p">,</span> <span class="mf">64.6</span><span class="p">,</span> <span class="mf">64.8</span><span class="p">,</span> <span class="mf">64.8</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>
<span class="n">xproj_grid</span><span class="p">,</span> <span class="n">yproj_grid</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
    <span class="p">[</span><span class="n">lo</span><span class="p">,</span> <span class="n">ro</span><span class="p">,</span> <span class="n">ro</span><span class="p">,</span> <span class="n">lo</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">lat</span><span class="p">,</span>
    <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xproj_grid</span><span class="p">,</span> <span class="n">yproj_grid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xproj_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.6e-4</span><span class="p">,</span> <span class="n">yproj_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mf">3e-5</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">"N'</span><span class="p">)</span>


<span class="c1"># # Plot a city</span>
<span class="c1"># reykjavik = [-21.9426], [64.1466]</span>
<span class="c1"># xproj_reykjavik, yproj_reykjavik = tilemapbase_project_array(</span>
<span class="c1">#     reykjavik[0],</span>
<span class="c1">#     reykjavik[1],</span>
<span class="c1">#     tilemapbase.project,</span>
<span class="c1"># )</span>
<span class="c1"># ax1.scatter(xproj_reykjavik, yproj_reykjavik, marker="h", c="k", label="Reykjavik")</span>


<span class="c1"># Add legends</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_15_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_15_0.png"/>
</div>
</div>
</section>
<section id="3:-Understanding-the-data-and-its-uncertainty">
<h2>3: Understanding the data and its uncertainty<a class="headerlink" href="#3:-Understanding-the-data-and-its-uncertainty" title="Permalink to this headline">#</a></h2>
<p>We have pre-processed all the data in the <code class="docutils literal notranslate"><span class="pre">data/</span></code> folder. The notebook in that folder contains the pre-processing steps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">"locatingquakes/data/data_array.npy"</span><span class="p">)</span>
<span class="n">uncertainty_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">"locatingquakes/data/uncertainty_array.npy"</span><span class="p">)</span>
<span class="n">snr_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">"locatingquakes/data/snr_array.npy"</span><span class="p">)</span>
<span class="n">event_descriptions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">"locatingquakes/data/csv_files.npy"</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">n_events</span> <span class="o">=</span> <span class="n">data_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p><strong>Data uncertainty</strong></p>
<p>In our Bayesian interpration, we use the L2 misfit function on first arrivals. The L2 metric allows for a data covariance matrix in the following way:</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[\begin{split}\mathbf{r} = \mathbf{d}_{obs} - \mathbf{d}_{syn} \\
\chi_{L2} = \frac{1}{2} \mathbf{r}^ T \, C_D^{-1}\, \mathbf{r}\end{split}\]</div></div>
<p>Where <span class="math notranslate nohighlight">\(\mathbf{d}_{obs}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{d}_{syn}\)</span> respectively describe the osberved and synthetic data, <span class="math notranslate nohighlight">\(\mathbf{r}\)</span> the data residual, and <span class="math notranslate nohighlight">\(C_D\)</span> the data covariance matrix.</p>
<p>The data uncertainty defines how much trust we put in the compound of our picks, theory, and other components that might introduce errors. Using a large number will allow data that deviates strongly from the observations, a low value only allows models to rigorously fit the data. Theoretically, this number is a defined quantity. However, we usually lack the tools, or even comprehension, to do a full analysis of all sources of uncertainty. Therefore, we simplify the value in this notebook by only
taking the Signal-to-Noise (SNR) ratio (which influences picking uncertainty) and our modelling uncertainty into account.</p>
<p>Note that by only calculating the data variance, we make <span class="math notranslate nohighlight">\(C_D\)</span> a diagonal matrix. This means that two data points are always assumed to be completely uncorrelated. This can be extended to include spatio-temporal correlations, but that is outside the scope of this notebook.</p>
<p>In our case, we are fairly certain that the homogeneous model is not accurate enough to explain all first arrivals. Hence we might want to allow slight variations to our observed data. But how much would our limited model (straight rays, homogeneous velocity) influence arrival times exactly? This is very hard to estimate, but judging by the data, we don’t want to be too much off, i.e. we don’t want to give a very high value. This value effectively sets the lower bound for data fitting. If only
the data covariance from the SNR is used, very small data covariance values are possible. We don’t think our physics can explain such small variations, so we opted for <span class="math notranslate nohighlight">\(0.1s\)</span>.</p>
<p>Luckily, we are supplied with SNR ratios for every channel/event combination. Now, we can easily calculate the total uncertainty from these values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Try out different values!</span>
<span class="n">modelling_variance</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">**</span><span class="mi">2</span>

<span class="n">data_covariance</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">snr_array</span> <span class="o">+</span> <span class="n">modelling_variance</span>

<span class="n">logbins</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s2">"Data standard deviation before and after</span><span class="se">\n</span><span class="s2">the inclusion of modelling uncertainty."</span>
<span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="p">((</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">snr_array</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">logbins</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">"pure Singal-to-Noise influence on picking"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="p">(</span><span class="n">data_covariance</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">logbins</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">"Total data covariance"</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">"log"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Occurences"</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Data standard deviation [seconds]"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_20_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_20_0.png"/>
</div>
</div>
<p>Effectively, adding modelling uncertainty cut off the left tail of this distribution: thereby avoiding overfitting.</p>
<p>For completeness, the <span class="math notranslate nohighlight">\(\chi_{L2}\)</span> is the function that Hamiltonian Monte Carlo will explore, possibly with terms added for the prior. Exploring this function will draw samples proportional to:</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[p \propto exp \left( - \chi_{L2} \right)\]</div></div>
<p>At this point, we can have a look at the data itself, and the accompanying uncertainties we just computed. Because not every event is observed on every channel, some data is missing. The algorithm will ignore the empty channels.</p>
<p>But, ignoring the empty channels means that the events that are observed on less will also have less of a contribution to the total likelihood. Thereby, we expect that these events see higher uncertainties or worse data fits.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize_double</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>


<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Arrival times per event"</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"event"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"channel"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_events</span><span class="p">),</span> <span class="n">event_descriptions</span><span class="p">)</span>


<span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">"right"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">"7%"</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">"2%"</span><span class="p">)</span>
<span class="n">cb1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax1</span><span class="p">)</span>
<span class="n">cb1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Relative arrival time [s]"</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">)</span>


<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Arrival time uncertainty"</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">data_covariance</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"event"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"channel"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_events</span><span class="p">),</span> <span class="n">event_descriptions</span><span class="p">)</span>
<span class="n">ax1_divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax1</span> <span class="o">=</span> <span class="n">ax1_divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">"right"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">"7%"</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">"2%"</span><span class="p">)</span>
<span class="n">cb1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax1</span><span class="p">)</span>
<span class="n">cb1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Arrival time uncertainty [s]"</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">"auto"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_23_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_23_0.png"/>
</div>
</div>
</section>
<section id="4:-Creating-the-Bayesian-interpretation">
<h2>4: Creating the Bayesian interpretation<a class="headerlink" href="#4:-Creating-the-Bayesian-interpretation" title="Permalink to this headline">#</a></h2>
<p>The next step is integrating all our data and knowledge into probability density functions.</p>
<p>For our <strong>prior</strong> knowledge, we make a few key assumptions, but try to hold back on forcing the inversion in any direction. We will asumme that the event occurs within a square around the zero, with edge length 16km, but truncated at 2000 meter elevation (fairly decent assumption we hope). We will also assume that all events occur <em>before</em> the very first arrival on the das cable. Although this makes physical sense to us, we need to tell this to the probability distribution. Below there is a
uniform distribution with these parameters created for a single event, and repeated as many times as needed.</p>
<p>Lastly <strong>the prior on the velocity</strong> is a harder thing to define. especially since every event might require a very different effective medium velocity. It will likely actually matter <em>per channel</em> what the effective medium velocity is. However, this homogeneous model is a decent simplification for now. We chose to use a uniform prior between 10m/s and 10’000m/s. This can be changed to investigate results for a more specific medium velocity.</p>
<p>For the <strong>data</strong>, this includes the data we just saw, combined with our defined uncertainty and a measure of data fit. We will use an L2 misfit between the synthetic (or predicted) data and the observations. This misfit allows us to directly integrate our uncertainty in a straightforward way. This misfit is standard in <code class="docutils literal notranslate"><span class="pre">hmc_tomography.Distributions.SourceLocation3D</span></code>.</p>
<p><strong>Tempering</strong></p>
<p>Note that tempering is used. This means we take our posterior, and allow much worse solutions for a while. This is a typical technique for Monte Carlo, where our first Markov chain samples much worse misfits, to find as much minima as it can. We will run a few Markov chains at the true solution, and a few tempered. All the chains attempt to exchange states with eachother at pre-specified intervals.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create prior ----------------------------------------------------------------</span>
<span class="c1"># X,Y: within -8km &lt;-&gt; 8km square (edge length 16km)</span>
<span class="c1"># Z: between -8km &lt;-&gt; 2km</span>
<span class="c1"># T: between -10, 1 (anything higher than 0 is later than the first arrival: actually unpyhysical)</span>
<span class="n">source_pos_time_prior</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Distributions</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span>
    <span class="p">[</span><span class="o">-</span><span class="mi">8000</span><span class="p">,</span> <span class="o">-</span><span class="mi">8000</span><span class="p">,</span> <span class="o">-</span><span class="mi">8000</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">8000</span><span class="p">,</span> <span class="mi">8000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># V: Uniform between 10/s &lt;-&gt; 10'000 m/s</span>
<span class="n">vel_prior</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Distributions</span><span class="o">.</span><span class="n">Uniform</span><span class="p">([</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10000</span><span class="p">])</span>

<span class="c1"># Combine all priors</span>
<span class="c1"># One could give a different location prior to each event,</span>
<span class="c1"># but here the priors are kept constant.</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Distributions</span><span class="o">.</span><span class="n">CompositeDistribution</span><span class="p">(</span>
    <span class="p">[</span><span class="n">source_pos_time_prior</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_events</span> <span class="o">+</span> <span class="p">[</span><span class="n">vel_prior</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Create the same posterior 10 times  ------------------------------------------</span>
<span class="n">algorithm_replicas</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">posteriors</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># This schedule gives half the chains T=1, and the other half are increasing</span>
<span class="c1"># temperature. All chains exchange information.</span>
<span class="n">temperatures</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">algorithm_replicas</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">algorithm_replicas</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">algorithm_replicas</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">):</span>

    <span class="c1"># Tempering is simply scaling the covariance for the L2 function</span>
    <span class="n">covariance</span> <span class="o">=</span> <span class="p">(</span><span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">data_covariance</span>

    <span class="n">likelihood</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Distributions</span><span class="o">.</span><span class="n">SourceLocation3D</span><span class="p">(</span>
        <span class="n">x_das</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span>
        <span class="n">y_das</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span>
        <span class="n">z_das</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span>
        <span class="n">data_array</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">covariance</span><span class="o">.</span><span class="n">T</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># The module takes in only data standard deviation</span>
        <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Invert for velocity</span>
    <span class="p">)</span>

    <span class="c1"># Combine the prior with the (possible tempered) posterior</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Distributions</span><span class="o">.</span><span class="n">BayesRule</span><span class="p">([</span><span class="n">likelihood</span><span class="p">,</span> <span class="n">prior</span><span class="p">])</span>
    <span class="n">posteriors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Temperature schedule: </span><span class="si">{</span><span class="p">[(</span><span class="n">temp</span><span class="p">)</span> <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temperatures</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Temperature schedule: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 10.0, 100.0, 1000.0, 10000.0]
</pre></div></div>
</div>
</section>
<section id="5:-Sampling">
<h2>5: Sampling<a class="headerlink" href="#5:-Sampling" title="Permalink to this headline">#</a></h2>
<p>Now we can <em>almost</em> start sampling. We first need to say at what model parameters (medium velocity, locations) our samplers should start.</p>
<p>There are multiple schools of thought regarding starting models. One can advocate to remove all bias, and draw starting models from the prior distribution. One might also be able to come up with a guess based on the physics at hand, greatly accelerating the initial burn-in phase at the risk of biasing the algorithms. Below, we have implemented both.</p>
<p>Simply change <code class="docutils literal notranslate"><span class="pre">use_guesses</span></code> to False to use a completely random prior model. Leaving <code class="docutils literal notranslate"><span class="pre">use_guesses</span></code> as True will use the horizontal location of the channel that detects the event earliest. It will subsequently draw a random depth, and use origin time 0. <strong>By also randomizing this initial depth per algorithm copy</strong>, we are able to test the influence of the starting model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_guesses</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Change this if you want!</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="c1"># Create starting models ------------------------------------------------------</span>
<span class="c1"># Find on which channel the minimum arrival time is</span>
<span class="n">first_arrival_channel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Use horizontal location of channel as initial location for each event</span>
<span class="n">guess_x</span> <span class="o">=</span> <span class="n">x_das</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
<span class="n">guess_y</span> <span class="o">=</span> <span class="n">y_das</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
<span class="n">guess_t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">guess_y</span><span class="p">)</span>
<span class="n">guess_velocity</span> <span class="o">=</span> <span class="mi">1200</span>


<span class="n">starting_models</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="n">use_guesses</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">):</span>
        <span class="c1"># Generate a random depth, different for each copy of the algorithm we are running/\</span>
        <span class="n">random_z</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">3999</span><span class="p">,</span> <span class="n">z_das_polar</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">guess_y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Wrap everything up in the order: x1,y1,z1,t1,x2,y2,z2, ..., v0</span>
        <span class="c1"># i.e. 'weaving multiple arrays'</span>
        <span class="n">starting_model</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">guess_x</span><span class="p">,</span> <span class="n">guess_y</span><span class="p">,</span> <span class="n">random_z</span><span class="p">,</span> <span class="n">guess_t</span><span class="p">)),</span> <span class="p">[]</span>
        <span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">guess_velocity</span><span class="p">]</span>

        <span class="c1"># And put them in a list</span>
        <span class="n">starting_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">starting_model</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Generate random starting models for every copy of the algorithm.</span>
    <span class="n">starting_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">prior</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<p>Let’s look at where the locations start out:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the background image source</span>
<span class="n">tilemapbase</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">map_background</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">Stamen_Terrain_Background</span>

<span class="c1"># Set the map extent of the large map</span>
<span class="n">degrees_range1</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">extent1</span> <span class="o">=</span> <span class="n">tilemapbase_create_extent</span><span class="p">(</span>
    <span class="p">(</span><span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lat_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">degrees_range1</span>
<span class="p">)</span>

<span class="c1"># Create figure and axes</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Create the plotter for axes</span>
<span class="n">plotter1</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">extent1</span><span class="p">,</span> <span class="n">map_background</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plotter1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">map_background</span><span class="p">)</span>


<span class="c1"># Plot the cable</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xproj_das</span><span class="p">,</span> <span class="n">yproj_das</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"DAS acquisition geometry"</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">):</span>

    <span class="n">start_x</span> <span class="o">=</span> <span class="n">starting_models</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">start_y</span> <span class="o">=</span> <span class="n">starting_models</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">guess_lon</span><span class="p">,</span> <span class="n">guess_lat</span> <span class="o">=</span> <span class="n">to_lonlat</span><span class="p">(</span><span class="n">start_x</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
    <span class="n">guess_projx</span><span class="p">,</span> <span class="n">guess_projy</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
        <span class="n">guess_lon</span><span class="p">,</span> <span class="n">guess_lat</span><span class="p">,</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span>
    <span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">"Initial placement of events"</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">guess_projx</span><span class="p">,</span> <span class="n">guess_projy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"r"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>


<span class="c1"># Add legends</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_30_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_30_0.png"/>
</div>
</div>
<p>All good, looks like we have two clusters.</p>
<p>Now that we are about to create the sampler, we should think about preconditioning it using the mass matrix. This mass matrix accelerates the algorithm by scaling the posterior dimensions, but it does not alter the results of the Markov chain. It simply enhances the efficiency.</p>
<p>Ideally, one would have a certain expectation on the variation of each parameter, and include that in the mass matrix. In this case, we expect variation to vary on the order of 1e3, velocity on the order of 1e2 and origin time only on the order of 1e0. The mass matrix should be approximately equal to the inverse posterior covariance matrix for optimal results, hence the reciprocal of our expected variance has become our mass matrix diagonal.</p>
<p>We have left the code for a non-perconditioned version of HMC, using a Unit mass matrix. Using that will likely yield worse results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the mass matrix ----------------------------------------------</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">MassMatrices</span><span class="o">.</span><span class="n">Diagonal</span><span class="p">(</span>
    <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_events</span> <span class="o">+</span> <span class="p">[</span><span class="mi">100</span><span class="p">]))[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Uncomment to try a Unit mass matrix.</span>
<span class="c1"># mass = hmclab.MassMatrices.Unit(diagonal.size)</span>
</pre></div>
</div>
</div>
<p>Now, we are all set to sample. We create the parallel infrastructure using the controller <code class="docutils literal notranslate"><span class="pre">ParallelSampleSMP</span></code> (which stands for shared memory pool, i.e. samplers that run on a single machine). We give this controller all samplers (i.e. 10 copies of HMC), all filenames to which to save our samples, and all posteriors.</p>
<p>Additionally, we tell the controller to exchange samples after 5 HMC proposals. This ensures that the high temperature chains supply distant models to our <span class="math notranslate nohighlight">\(T=1\)</span> chains. Finally, we let the HMC algorithms autotune their stepsize. By lowering the target acceptance rate and slightly increasing the amount of steps, one obtains slightly more distant samples, useful in cheap but strongly non-linear models, such as this. The exact numbers one should use are not known, so <code class="docutils literal notranslate"><span class="pre">amount_of_steps</span></code> is a
parameter that should still be chosen with some trial and error. When in doubt, values around <code class="docutils literal notranslate"><span class="pre">10</span></code> seem to work well.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample ----------------------------------------------------------------------</span>
<span class="n">parallel_controller</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Samplers</span><span class="o">.</span><span class="n">ParallelSampleSMP</span><span class="p">()</span>

<span class="n">samplers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hmclab</span><span class="o">.</span><span class="n">Samplers</span><span class="o">.</span><span class="n">HMC</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">)]</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"locatingquakes/samples/samples_grimsvotn_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.h5"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">)]</span>

<span class="n">parallel_controller</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">samplers</span><span class="p">,</span>
    <span class="n">filenames</span><span class="p">,</span>
    <span class="n">posteriors</span><span class="p">,</span>
    <span class="n">overwrite_existing_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exchange</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">exchange_interval</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">proposals</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">),</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"autotuning"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">"mass_matrix"</span><span class="p">:</span> <span class="n">mass</span><span class="p">,</span>
        <span class="s2">"online_thinning"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">"target_acceptance_rate"</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s2">"amount_of_steps"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">initial_model</span><span class="o">=</span><span class="n">starting_models</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="6:-Analysis-and-interpretation">
<h2>6: Analysis and interpretation<a class="headerlink" href="#6:-Analysis-and-interpretation" title="Permalink to this headline">#</a></h2>
<p>A good first start is almost always to look at the misfit during the chain. Altough we altered our posteriors by tempering, it is fairly easy to obtain the original misfits (i.e. probabilities) if that chain would have been run at <span class="math notranslate nohighlight">\(T=1\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot misfit over time ---------------------------------------------------</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize_double</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">):</span>

    <span class="c1"># Load ALL sample misfits</span>
    <span class="k">with</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Samples</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">as</span> <span class="n">samples</span><span class="p">:</span>
        <span class="n">samples_misfits</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">misfits</span>

    <span class="c1"># Set labels and colours</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Sampler </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> @ T=</span><span class="si">{</span><span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="s2">"k"</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Sampler array @ T=1 (</span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temperatures</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> copies)"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Correct the misfit for temperature</span>
    <span class="n">misfits_corrected</span> <span class="o">=</span> <span class="n">samples_misfits</span> <span class="o">*</span> <span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">misfits_corrected</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">misfits_corrected</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Sample index"</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Sample index"</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Misfit"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_38_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_38_0.png"/>
</div>
</div>
<p>Seems good. Initially (on the left), most Markov chains are strongly in the burn-in phase. We can see that after approximately 100 samples seemingly stable levels are reached.</p>
<p>If we visualize the velocities that are sampled in all seperate chains (below), we see how the chains ran at higher temperatures are more lenient in admitting larger variations. Where the original inverse problems sample only very small misfits, the ‘hot’ chains are allowed to make guesses that are of much higher misfit. Thereby, these chains might move into different ‘basins of attraction’, or modes, in the misfit/pdf landscape. As these chains exchange states, the ‘hot’ chains help the
original inverse problems (the ‘cold’ chains) to converge much faster (i.e. explore all relevant local minima).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<span class="n">logbins</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Samples</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">as</span> <span class="n">samples</span><span class="p">:</span>
        <span class="n">samples_n</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">numpy</span>
        <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s2">"k"</span>

        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"T=</span><span class="si">{</span><span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">if</span> <span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"T=</span><span class="si">{</span><span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temperatures</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> copies)"</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">samples_n</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">logbins</span><span class="p">,</span>
            <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">500</span><span class="p">,</span> <span class="mi">10000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Medium velocity [m/s]"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Probability"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Posterior distributions of medium velocity"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">"log"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_40_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_40_0.png"/>
</div>
</div>
<p>We sampled the actual posterior using multiple Markov chains, so we can now combine their results together in an ensemble. We will print the best model in each chain.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load samples ----------------------------------------------------------------</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Samples</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">as</span> <span class="n">samples</span><span class="p">:</span>
        <span class="n">samples_n</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">numpy</span>

    <span class="n">best_model_chain</span> <span class="o">=</span> <span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">samples_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])][:,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Chain </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, temperature </span><span class="si">{</span><span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="se">\t</span><span class="s2">"</span>
        <span class="sa">f</span><span class="s2">"Minimum misfit: </span><span class="si">{</span><span class="n">posteriors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">misfit</span><span class="p">(</span><span class="n">best_model_chain</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">()</span>
<span class="n">final_samples</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">algorithm_replicas</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">temperatures</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Adding chain </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> with temperature 1 to final results"</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Samples</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">burn_in</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">samples</span><span class="p">:</span>
        <span class="n">final_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">numpy</span><span class="p">)</span>

<span class="n">final_samples</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">final_samples</span><span class="p">)</span>


<span class="n">best_model_overall</span> <span class="o">=</span> <span class="n">final_samples</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">final_samples</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])][:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">synthetics_best_model_overall</span> <span class="o">=</span> <span class="n">likelihood</span><span class="o">.</span><span class="n">forward_vector</span><span class="p">(</span><span class="n">best_model_overall</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Chain 0, temperature 1.00,      Minimum misfit: 35.91
Chain 1, temperature 1.00,      Minimum misfit: 38.77
Chain 2, temperature 1.00,      Minimum misfit: 17.88
Chain 3, temperature 1.00,      Minimum misfit: 25.83
Chain 4, temperature 1.00,      Minimum misfit: 30.41
Chain 5, temperature 1.00,      Minimum misfit: 16.90
Chain 6, temperature 10.00,     Minimum misfit: 49.45
Chain 7, temperature 100.00,    Minimum misfit: 324.30
Chain 8, temperature 1000.00,   Minimum misfit: 1156.65
Chain 9, temperature 10000.00,  Minimum misfit: 2993.20

Adding chain 0 with temperature 1 to final results
Adding chain 1 with temperature 1 to final results
Adding chain 2 with temperature 1 to final results
Adding chain 3 with temperature 1 to final results
Adding chain 4 with temperature 1 to final results
Adding chain 5 with temperature 1 to final results
</pre></div></div>
</div>
<p>It’s a little bit cleaner to plot the velocity of the combined ensemble. If this distrubtion is strongly multimodal, this indicates that the events can not be well explained by a homogeneous medium. Luckily, with the Bayesian approach, we can investigate this.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>
<span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">final_samples</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Medium velocity [m/s]"</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Probability"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Posterior marginal medium velocity from ensemble"</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">bins</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">bins</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_44_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_44_0.png"/>
</div>
</div>
<p>Let’s look at the best data fit over all samples from the <span class="math notranslate nohighlight">\(T=1\)</span> chains. Additionally, the <span class="math notranslate nohighlight">\(0.1\sigma\)</span> confidence intervals are plotted, to show that the best models are very close to the observed data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rows</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_events</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">rows</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_events</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">synthetics_best_model_overall</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"synthetics best sample"</span><span class="p">)</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data_array</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>

    <span class="n">dat_pls_sigma</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">((</span><span class="n">data_array</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">data_covariance</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">dat_min_sigma</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">((</span><span class="n">data_array</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">data_covariance</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"true picks"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat_pls_sigma</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s2">"k"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat_min_sigma</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s2">"k"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"$0.1 \sigma$"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Channel id"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"First arrival time [s]"</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Event </span><span class="si">{</span><span class="n">event_descriptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, portion of channels: "</span>
        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_array</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
        <span class="sa">f</span><span class="s2">"Estimated depth: </span><span class="si">{</span><span class="n">final_samples</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">"</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">T</span><span class="p">))),</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">T</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_46_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_46_0.png"/>
</div>
</div>
<p>Lets now take a look at the most anticipated plots. The point clouds in 2D seen from the side are given below. In the cells later, we will also get a top down view.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize_double</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i_subplot</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">]):</span>

    <span class="c1"># Grab y,z locations, and channel count ...</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">final_samples</span><span class="p">[</span><span class="n">event</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">final_samples</span><span class="p">[</span><span class="n">event</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">channel_fraction</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_array</span><span class="p">[:,</span> <span class="n">event</span><span class="p">]))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_array</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># ... plot ...</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i_subplot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_das</span><span class="p">,</span> <span class="n">z_das_polar</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span> <span class="n">z</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">"r"</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">"."</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="s2">"r"</span><span class="p">)</span>

    <span class="c1"># ... and make pretty</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"event </span><span class="si">{</span><span class="n">event_descriptions</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="si">}</span><span class="s2">, marginal for Y,Z,</span><span class="se">\n</span><span class="s2">portion of channels: "</span>
        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">channel_fraction</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"horizontal position y [metres]"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"elevation [metres]"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_48_0.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_48_0.png"/>
</div>
</div>
<p>These plots really illustrate the varying uncertainty in locating these events. The direction of uncertainty strongly depends on where an event occured. Let’s now view those same events top down:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tilemapbase</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">Stamen_Terrain</span>

<span class="n">degrees_range1</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">extent</span> <span class="o">=</span> <span class="n">tilemapbase_create_extent</span><span class="p">(</span>
    <span class="p">(</span><span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lat_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">degrees_range1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="n">plotter</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="n">x_projected</span><span class="p">,</span> <span class="n">y_projected</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
    <span class="n">lon_das_polar</span><span class="p">,</span> <span class="n">lat_das_polar</span><span class="p">,</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span>
<span class="p">)</span>


<span class="k">for</span> <span class="n">i_event</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">]):</span>

    <span class="c1"># Samples to lon/lat</span>
    <span class="n">samples_lon</span><span class="p">,</span> <span class="n">samples_lat</span> <span class="o">=</span> <span class="n">to_lonlat</span><span class="p">(</span>
        <span class="n">final_samples</span><span class="p">[</span><span class="n">event</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,::</span><span class="mi">10</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">final_samples</span><span class="p">[</span><span class="n">event</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,::</span><span class="mi">10</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">origin</span>
    <span class="p">)</span>

    <span class="c1"># Samples to unit square for map</span>
    <span class="n">samples_lon</span><span class="p">,</span> <span class="n">samples_lat</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
        <span class="n">samples_lon</span><span class="p">,</span> <span class="n">samples_lat</span><span class="p">,</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span>
    <span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Event </span><span class="si">{</span><span class="n">event_descriptions</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>

    <span class="c1"># Plotting the samples, with a second trick to get a nice legend</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samples_lon</span><span class="p">,</span> <span class="n">samples_lat</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">"."</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">scatter</span><span class="o">.</span><span class="n">get_facecolors</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">color</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">samples_lon</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">samples_lat</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_projected</span><span class="p">,</span> <span class="n">y_projected</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"DAS acquisition geometry"</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x15b9d4340&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_50_1.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_50_1.png"/>
</div>
</div>
<p>So these events are (as on might expect), the best localized in the direction that has the most channels, or, in the direction of the DAS cable. But these uncertainty volumes are not strictly Gaussian.</p>
<p>To summarize the statistics of all events, we can draw uncertainty-ellipses. These plots condense the posterior to a Gaussian approximation, allowing us to quickly distill the uncertainty information of many to a single plot. This is, however, not fully accurate if posteriors are highly non-linear. Nonetheless, the following plot should provide useful in localizing clusters of events and their typical orientations of uncertainty.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tilemapbase</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">tiles</span><span class="o">.</span><span class="n">Stamen_Terrain</span>

<span class="n">degrees_range1</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">extent</span> <span class="o">=</span> <span class="n">tilemapbase_create_extent</span><span class="p">(</span>
    <span class="p">(</span><span class="n">lon_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lat_das_polar</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">degrees_range1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="n">plotter</span> <span class="o">=</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="n">x_projected</span><span class="p">,</span> <span class="n">y_projected</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
    <span class="n">lon_das_polar</span><span class="p">,</span> <span class="n">lat_das_polar</span><span class="p">,</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span>
<span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_events</span><span class="p">):</span>

    <span class="n">samples_lon</span><span class="p">,</span> <span class="n">samples_lat</span> <span class="o">=</span> <span class="n">to_lonlat</span><span class="p">(</span>
        <span class="n">final_samples</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">final_samples</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">origin</span>
    <span class="p">)</span>

    <span class="n">samples_lon_projected</span><span class="p">,</span> <span class="n">samples_lat_projected</span> <span class="o">=</span> <span class="n">tilemapbase_project_array</span><span class="p">(</span>
        <span class="n">samples_lon</span><span class="p">,</span> <span class="n">samples_lat</span><span class="p">,</span> <span class="n">tilemapbase</span><span class="o">.</span><span class="n">project</span>
    <span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">"potential location and uncertainty"</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">samples_lon_projected</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="n">samples_lat_projected</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">"."</span><span class="p">,</span>
        <span class="n">c</span><span class="o">=</span><span class="s2">"r"</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">confidence_ellipse</span><span class="p">(</span>
        <span class="n">samples_lon_projected</span><span class="p">,</span> <span class="n">samples_lat_projected</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">n_std</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"red"</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x_projected</span><span class="p">,</span> <span class="n">y_projected</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"DAS acquisition geometry"</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x15bb95e20&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_52_1.png" src="../../_images/notebooks_examples_Locating_quakes_on_Grimsvötn,_Iceland_52_1.png"/>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Elastic%202d%20FWI.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Probabilistic Elastic FWI</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="Sampling%20sparse%20linear%20equations.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Linear (sparse) forward operator</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-2022, Andrea Zunino, Lars Gebraad, Andreas Fichtner
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Locating quakes on Grimsvötn, Iceland</a><ul>
<li><a class="reference internal" href="#Intro">Intro</a></li>
<li><a class="reference internal" href="#1:-The-physics">1: The physics</a></li>
<li><a class="reference internal" href="#2:-The-domain">2: The domain</a></li>
<li><a class="reference internal" href="#3:-Understanding-the-data-and-its-uncertainty">3: Understanding the data and its uncertainty</a></li>
<li><a class="reference internal" href="#4:-Creating-the-Bayesian-interpretation">4: Creating the Bayesian interpretation</a></li>
<li><a class="reference internal" href="#5:-Sampling">5: Sampling</a></li>
<li><a class="reference internal" href="#6:-Analysis-and-interpretation">6: Analysis and interpretation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>