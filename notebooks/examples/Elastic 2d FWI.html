<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="API reference" href="../../api/index.html" /><link rel="prev" title="Locating quakes on Grimsvötn, Iceland" href="Locating%20quakes%20on%20Grimsv%C3%B6tn%2C%20Iceland.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>Probabilistic Elastic FWI - Version 1.0</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../_static/autoclasstoc.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Version 1.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/HMC Lab.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/HMC Lab-dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Version 1.0</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">HMC Lab // Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hmc.html">The Hamiltonian Monte Carlo algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Installation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../notebooks.html">Notebooks: Examples and tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../../index-tutorials.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/0%20-%20Getting%20started.html">Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/1%20-%20Tuning%20Hamiltonian%20Monte%20Carlo.html">Tuning Hamiltonian Monte Carlo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/2%20-%20Separate%20priors%20per%20dimension.html">Separate priors per dimension</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/3%20-%20Creating%20your%20own%20inverse%20problem.html">Creating your own inverse problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/4%20-%20Running%20parallel%20Markov%20chains.html">Running parallel Markov chains</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/5%20-%20Transforming%20parameters.html">Transforming existing distributions</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../../index-examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Sampling%20linear%20equations.html">Linear (dense) forward operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="Sampling%20sparse%20linear%20equations.html">Linear (sparse) forward operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="Locating%20quakes%20on%20Grimsv%C3%B6tn%2C%20Iceland.html">Locating quakes on Grimsvötn, Iceland</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Probabilistic Elastic FWI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/distributions/index.html">Distributions</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions._AbstractDistribution.html">_AbstractDistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.StandardNormal1D.html">StandardNormal1D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Normal.html">Normal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Laplace.html">Laplace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Uniform.html">Uniform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.LinearMatrix.html">LinearMatrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.CompositeDistribution.html">CompositeDistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.AdditiveDistribution.html">AdditiveDistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.BayesRule.html">BayesRule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.Himmelblau.html">Himmelblau</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.SourceLocation2D.html">SourceLocation2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/distributions/_autosummary/hmclab.Distributions.SourceLocation3D.html">SourceLocation3D</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/massmatrices/index.html">MassMatrices</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/massmatrices/_autosummary/hmclab.MassMatrices._AbstractMassMatrix.html">_AbstractMassMatrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/massmatrices/_autosummary/hmclab.MassMatrices.Unit.html">Unit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/massmatrices/_autosummary/hmclab.MassMatrices.Diagonal.html">Diagonal</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/samplers/index.html">Samplers</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/samplers/_autosummary/hmclab.Samplers._AbstractSampler.html">_AbstractSampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/samplers/_autosummary/hmclab.Samplers.RWMH.html">RWMH</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/samplers/_autosummary/hmclab.Samplers.HMC.html">HMC</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/optimizers/index.html">Optimizers</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/optimizers/_autosummary/hmclab.Optimizers.gradient_descent.html">hmclab.Optimizers.gradient_descent</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/visualization/index.html">Visualization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualization/marginal.html">marginal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualization/marginal_grid.html">marginal_grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/visualization/visualize_2_dimensions.html">visualize_2_dimensions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/_autosummary/hmclab.Samples.html">Samples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../py-modindex.html">Module index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Alphabetic index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Probabilistic-Elastic-FWI">
<h1>Probabilistic Elastic FWI<a class="headerlink" href="#Probabilistic-Elastic-FWI" title="Permalink to this headline">#</a></h1>
<p>In this notebook we look at probabilistic elastic Full-Waveform Inversion. The example here is purposefully kept very small with only little data, to facilitate experimentation.</p>
<p>We will use the external package <code class="docutils literal notranslate"><span class="pre">psvWave</span></code>, which implements Virieux 1986’s staggered FD scheme for P-SV wave propagation. Gradients are calculated using the adjoint method.</p>
<p>Note that the ‘wheels’ for psvWave are only guaranteed to work for Linux, on Python 3.7.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hmclab</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">psvWave</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">AxesGrid</span>
</pre></div>
</div>
</div>
<p>First we start by creating some synthetic data. psvWave provides a basic setting in which one can run experiments. Let’s load those settings and have a look at them:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fwi_settings</span> <span class="o">=</span> <span class="n">psvWave</span><span class="o">.</span><span class="n">fdModel</span><span class="o">.</span><span class="n">get_dictionary</span><span class="p">()</span>

<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"domain"</span><span class="p">][</span><span class="s2">"nx_inner"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"domain"</span><span class="p">][</span><span class="s2">"nz_inner"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"domain"</span><span class="p">][</span><span class="s2">"nx_inner_boundary"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"domain"</span><span class="p">][</span><span class="s2">"nz_inner_boundary"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"boundary"</span><span class="p">][</span><span class="s2">"np_boundary"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"sources"</span><span class="p">][</span><span class="s2">"ix_sources"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"sources"</span><span class="p">][</span><span class="s2">"iz_sources"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"receivers"</span><span class="p">][</span><span class="s2">"ix_receivers"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"receivers"</span><span class="p">][</span><span class="s2">"iz_receivers"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>

<span class="n">fwi_settings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{'domain': {'nt': 1000,
  'nx_inner': 20,
  'nz_inner': 20,
  'nx_inner_boundary': 0,
  'nz_inner_boundary': 0,
  'dx': 1.249,
  'dz': 1.249,
  'dt': 0.0002},
 'boundary': {'np_boundary': 10, 'np_factor': 0.015},
 'medium': {'scalar_rho': 1500.0, 'scalar_vp': 2000.0, 'scalar_vs': 800.0},
 'sources': {'peak_frequency': 50.0,
  'n_sources': 2,
  'n_shots': 1,
  'source_timeshift': 0.005,
  'delay_cycles_per_shot': 24,
  'moment_angles': [90, 180],
  'ix_sources': [2, 18],
  'iz_sources': [2, 2],
  'which_source_to_fire_in_which_shot': [[0, 1]]},
 'receivers': {'nr': 4,
  'ix_receivers': [4, 8, 12, 16],
  'iz_receivers': [18, 18, 18, 18]},
 'inversion': {'snapshot_interval': 10},
 'basis': {'npx': 1, 'npz': 1},
 'output': {'observed_data_folder': '.', 'stf_folder': '.'}}
</pre></div></div>
</div>
<p>We see that this simulation has two sources (moment tensors with Ricker wave STF’s) that are on the ‘bottom’ of the medium. These are recorded by sources at the top. The medium is surrounded by an absorbing boundary. Let’s compress the simulation a bit and shorten it by firing the sources close together:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"domain"</span><span class="p">][</span><span class="s2">"nt"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1400</span>
<span class="n">fwi_settings</span><span class="p">[</span><span class="s2">"sources"</span><span class="p">][</span><span class="s2">"delay_cycles_per_shot"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
<p>Now we can create this simulation object with the requested settings:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psvWave</span><span class="o">.</span><span class="n">fdModel</span><span class="o">.</span><span class="n">write_dictionary</span><span class="p">(</span><span class="s2">"settings.ini"</span><span class="p">,</span> <span class="n">fwi_settings</span><span class="p">)</span>

<span class="n">fdModel</span> <span class="o">=</span> <span class="n">psvWave</span><span class="o">.</span><span class="n">fdModel</span><span class="p">(</span><span class="s2">"settings.ini"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading configuration file: 'settings.ini'.
Parsing passed configuration.
</pre></div></div>
</div>
<p>We can plot the geometry of all shots by doing the following.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i_shot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fdModel</span><span class="o">.</span><span class="n">n_shots</span><span class="p">):</span>
    <span class="n">fdModel</span><span class="o">.</span><span class="n">plot_domain</span><span class="p">(</span><span class="n">shot_to_plot</span><span class="o">=</span><span class="n">i_shot</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Shot </span><span class="si">{</span><span class="n">i_shot</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Elastic_2d_FWI_10_0.png" src="../../_images/notebooks_examples_Elastic_2d_FWI_10_0.png"/>
</div>
</div>
<p>To look how HMC works in this settings, we need an interesting model to test on. We create a target model below, which contains a spherical anomaly in P-wave velocity, S-wave velocity and density:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create target model</span>
<span class="c1"># Get the coordinates of every grid point</span>
<span class="n">IX</span><span class="p">,</span> <span class="n">IZ</span> <span class="o">=</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Get the associated parameter fields</span>
<span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">get_parameter_fields</span><span class="p">()</span>

<span class="n">x_middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">IX</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">IX</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">z_middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">IZ</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">IZ</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>

<span class="c1"># Add a circular negative anomaly to the 'true' model</span>
<span class="n">circle</span> <span class="o">=</span> <span class="p">((</span><span class="n">IX</span> <span class="o">-</span> <span class="n">x_middle</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">IZ</span> <span class="o">-</span> <span class="n">z_middle</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">&lt;</span> <span class="mi">5</span>
<span class="n">vs</span> <span class="o">=</span> <span class="n">vs</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">circle</span><span class="p">)</span>
<span class="n">vp</span> <span class="o">=</span> <span class="n">vp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">circle</span><span class="p">)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">circle</span><span class="p">)</span>

<span class="n">vp_target</span> <span class="o">=</span> <span class="n">vp</span>
<span class="n">vs_target</span> <span class="o">=</span> <span class="n">vs</span>
<span class="n">rho_target</span> <span class="o">=</span> <span class="n">rho</span>
</pre></div>
</div>
</div>
<p>Let’s visualize this anomaly in all parameters:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">background_means</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">1500</span><span class="p">])</span>
<span class="n">percentage_deviation</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">mins</span> <span class="o">=</span> <span class="n">background_means</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentage_deviation</span><span class="p">)</span>
<span class="n">maxs</span> <span class="o">=</span> <span class="n">background_means</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">percentage_deviation</span><span class="p">)</span>

<span class="n">fdModel</span><span class="o">.</span><span class="n">set_parameter_fields</span><span class="p">(</span><span class="n">vp_target</span><span class="p">,</span> <span class="n">vs_target</span><span class="p">,</span> <span class="n">rho_target</span><span class="p">)</span>
<span class="n">fdModel</span><span class="o">.</span><span class="n">plot_fields</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">mins</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maxs</span><span class="p">)</span>
<span class="n">true_model</span> <span class="o">=</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">get_model_vector</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Elastic_2d_FWI_14_0.png" src="../../_images/notebooks_examples_Elastic_2d_FWI_14_0.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> fdModel.forward_simulate(0, omp_threads_override=6)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 157 ms, sys: 13.9 ms, total: 171 ms
Wall time: 28.7 ms
</pre></div></div>
</div>
<p>Let’s create the ‘observed’ data with some noise:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create 'true' data</span>
<span class="c1"># print("Faking observed data")</span>
<span class="k">for</span> <span class="n">i_shot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fdModel</span><span class="o">.</span><span class="n">n_shots</span><span class="p">):</span>
    <span class="n">fdModel</span><span class="o">.</span><span class="n">forward_simulate</span><span class="p">(</span><span class="n">i_shot</span><span class="p">,</span> <span class="n">omp_threads_override</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># Cheating of course, as this is synthetically generated data.</span>
<span class="n">ux_obs</span><span class="p">,</span> <span class="n">uz_obs</span> <span class="o">=</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">get_synthetic_data</span><span class="p">()</span>

<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">32312</span><span class="p">)</span>
<span class="n">ux_obs</span> <span class="o">+=</span> <span class="mi">25</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">ux_obs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">uz_obs</span> <span class="o">+=</span> <span class="mi">25</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">ux_obs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">fdModel</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">ux_obs</span><span class="p">,</span> <span class="n">uz_obs</span><span class="p">),</span> <span class="n">exagerration</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 576x216 with 2 Axes&gt;,
 array([[&lt;AxesSubplot:title={'center':'horizontal displacement shot 0'}, xlabel='time [s]', ylabel='channel id'&gt;,
         &lt;AxesSubplot:title={'center':'vertical displacement shot 0'}, xlabel='time [s]', ylabel='channel id'&gt;]],
       dtype=object))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Elastic_2d_FWI_17_1.png" src="../../_images/notebooks_examples_Elastic_2d_FWI_17_1.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ux_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x7f1b88a3bd90&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Elastic_2d_FWI_18_1.png" src="../../_images/notebooks_examples_Elastic_2d_FWI_18_1.png"/>
</div>
</div>
<p>To get some intuition on what we are actually doing, we can plot the wavefield in the one shot at two different points in time. This is the wavefield of the ‘true’ data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_step</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i_shot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fdModel</span><span class="o">.</span><span class="n">n_shots</span><span class="p">):</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">get_snapshots</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_shot</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">field_extr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="n">field_extr</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">field_extr</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="n">fdModel</span><span class="o">.</span><span class="n">get_extent</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">"seismic"</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Shot </span><span class="si">{</span><span class="n">i_shot</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, step 80"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">time_step</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i_shot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fdModel</span><span class="o">.</span><span class="n">n_shots</span><span class="p">):</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">get_snapshots</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_shot</span><span class="p">,</span> <span class="n">time_step</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">field_extr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="n">field_extr</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">field_extr</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="n">fdModel</span><span class="o">.</span><span class="n">get_extent</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">"seismic"</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Shot </span><span class="si">{</span><span class="n">i_shot</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, step 95"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Elastic_2d_FWI_20_0.png" src="../../_images/notebooks_examples_Elastic_2d_FWI_20_0.png"/>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_examples_Elastic_2d_FWI_20_1.png" src="../../_images/notebooks_examples_Elastic_2d_FWI_20_1.png"/>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sampler = hmclab.Samplers.HMC()</span>

<span class="c1"># posterior = hmclab.Distributions.ElasticFullWaveform2D(</span>
<span class="c1">#     "settings.ini",</span>
<span class="c1">#     ux_obs=ux_obs,</span>
<span class="c1">#     uz_obs=uz_obs,</span>
<span class="c1">#     omp_threads_override=6,</span>
<span class="c1">#     temperature=5**2,</span>
<span class="c1"># )</span>

<span class="c1"># posterior.update_bounds(</span>
<span class="c1">#     posterior.get_model_vector() - 200,</span>
<span class="c1">#     posterior.get_model_vector() + 200,</span>
<span class="c1"># )</span>

<span class="c1"># %rm samples.h5</span>

<span class="c1"># sampler.sample(</span>
<span class="c1">#     "samples.h5",</span>
<span class="c1">#     posterior,</span>
<span class="c1">#     autotuning=True,</span>
<span class="c1">#     initial_model=true_model[:,None],</span>
<span class="c1">#     amount_of_steps=10,</span>
<span class="c1">#     proposals=10000,</span>
<span class="c1">#     overwrite_existing_file=False,</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute parallel sampling</span>
<span class="n">parallel_sampler</span> <span class="o">=</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Samplers</span><span class="o">.</span><span class="n">ParallelSampleSMP</span><span class="p">()</span>

<span class="n">samplers</span> <span class="o">=</span> <span class="p">[</span><span class="n">hmclab</span><span class="o">.</span><span class="n">Samplers</span><span class="o">.</span><span class="n">HMC</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"samples_fwi_parallel_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.h5"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

<span class="n">temperatures</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">posteriors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">hmclab</span><span class="o">.</span><span class="n">Distributions</span><span class="o">.</span><span class="n">ElasticFullWaveform2D</span><span class="p">(</span>
        <span class="s2">"settings.ini"</span><span class="p">,</span>
        <span class="n">ux_obs</span><span class="o">=</span><span class="n">ux_obs</span><span class="p">,</span>
        <span class="n">uz_obs</span><span class="o">=</span><span class="n">uz_obs</span><span class="p">,</span>
        <span class="n">omp_threads_override</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="p">(</span><span class="mf">5.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temperatures</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">posterior</span> <span class="ow">in</span> <span class="n">posteriors</span><span class="p">:</span>
    <span class="n">posterior</span><span class="o">.</span><span class="n">update_bounds</span><span class="p">(</span>
        <span class="n">posterior</span><span class="o">.</span><span class="n">get_model_vector</span><span class="p">()</span> <span class="o">-</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">posterior</span><span class="o">.</span><span class="n">get_model_vector</span><span class="p">()</span> <span class="o">+</span> <span class="mi">200</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">initial_model</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">true_model</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">true_model</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">parallel_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">samplers</span><span class="p">,</span>
    <span class="n">filenames</span><span class="p">,</span>
    <span class="n">posteriors</span><span class="p">,</span>
    <span class="n">proposals</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">overwrite_existing_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">initial_model</span><span class="o">=</span><span class="n">true_model</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading configuration file: 'settings.ini'.
Parsing passed configuration.
Loading configuration file: 'settings.ini'.
Parsing passed configuration.
Starting 2 markov chains...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
sys:1: Warning:
Silently overwriting samples file (samples_fwi_parallel_0.h5) if it exists.
sys:1: Warning:
Silently overwriting samples file (samples_fwi_parallel_1.h5) if it exists.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
enter
enter
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b6db81a06524464c880c70b290cf7035", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<!-- empty output --></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posteriors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_model_vector</span><span class="p">(</span><span class="n">posteriors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_model_vector</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parallel_sampler</span><span class="o">.</span><span class="n">samplers</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">stepsizes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_23267/3789021934.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>plt<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>sampler<span class="ansi-blue-fg">.</span>stepsizes<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name 'sampler' is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">hmclab</span><span class="o">.</span><span class="n">Samples</span><span class="p">(</span><span class="s2">"samples.h5"</span><span class="p">)</span> <span class="k">as</span> <span class="n">samples</span><span class="p">:</span>
    <span class="n">samples_n</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">numpy</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">fdModel</span><span class="o">.</span><span class="n">plot_model_vector</span><span class="p">(</span><span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mins</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maxs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fdModel</span><span class="o">.</span><span class="n">plot_model_vector</span><span class="p">(</span>
    <span class="c1">#     posterior.blob.forward_transform_background(</span>
    <span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">mins</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="n">maxs</span>
    <span class="c1">#     )</span>
<span class="p">)</span>

<span class="n">fdModel</span><span class="o">.</span><span class="n">plot_model_vector</span><span class="p">(</span>
    <span class="c1">#     posterior.blob.forward_transform_background(</span>
    <span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="c1">#     )</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">m</span>  <span class="c1"># posterior.blob.forward_transform_background(m[:,None])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vector_splits</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">fields</span> <span class="o">=</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">get_parameter_fields</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
    <span class="n">field</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">field</span><span class="p">[</span>
        <span class="p">(</span><span class="n">fdModel</span><span class="o">.</span><span class="n">nx_inner_boundary</span> <span class="o">+</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">np_boundary</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span>
            <span class="n">fdModel</span><span class="o">.</span><span class="n">nx_inner_boundary</span> <span class="o">+</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">np_boundary</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">fdModel</span><span class="o">.</span><span class="n">nz_inner_boundary</span> <span class="o">+</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">np_boundary</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="p">(</span>
            <span class="n">fdModel</span><span class="o">.</span><span class="n">nz_inner_boundary</span> <span class="o">+</span> <span class="n">fdModel</span><span class="o">.</span><span class="n">np_boundary</span>
        <span class="p">),</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">vector_splits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">fdModel</span><span class="o">.</span><span class="n">nz_free_parameters</span><span class="p">,</span>
                <span class="n">fdModel</span><span class="o">.</span><span class="n">nx_free_parameters</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">T</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="n">sigma</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">"seismic"</span><span class="p">),</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">2200</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="n">sigma</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">"seismic"</span><span class="p">),</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="n">sigma</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">"seismic"</span><span class="p">),</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">1350</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">1650</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

<span class="c1"># C= np.cov(samples_n[:-1, :])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">40</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">"seismic"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="p">:</span><span class="mi">400</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">"seismic"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">samples_n</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samples_n</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../api/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API reference</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="Locating%20quakes%20on%20Grimsv%C3%B6tn%2C%20Iceland.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Locating quakes on Grimsvötn, Iceland</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-2022, Andrea Zunino, Lars Gebraad, Andreas Fichtner
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>